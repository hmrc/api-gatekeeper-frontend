@*
 * Copyright 2020 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import model._
@import model.view._
@import model.view.SubscriptionVersion
@import utils.LoggedInUser
@import views.helper._

@(applicationWithHistory: ApplicationWithHistory, subscriptionViewModel: SubscriptionVersion, form: Form[EditApiMetadataForm])(implicit request: Request[_], loggedInUser: LoggedInUser, flash: Flash, messages: Messages, appConfig: config.AppConfig)
@application = @{applicationWithHistory.application}
@access = @{application.access}
@pageTitle = @{s"${subscriptionViewModel.apiName} ${subscriptionViewModel.version} ${subscriptionViewModel.displayedStatus}"}

@main(title = s"${appConfig.title} - $pageTitle") {

<div class="">

    <nav class="breadcrumb-nav">
        <ul>
            <li class="breadcrumb-nav__item"><a href="@{routes.ApplicationController.applicationPage(application.id.toString)}">@application.name</a></li>
            <li class="breadcrumb-nav__item breadcrumb-nav__item--trail" aria-hidden="true"></li>
            <li class="breadcrumb-nav__item"><a href="@{routes.SubscriptionConfigurationController.listConfigurations(application.id.toString)}">Subscription configuration</a></li>
            <li class="breadcrumb-nav__item breadcrumb-nav__item--trail" aria-hidden="true"></li>
            <li class="breadcrumb-nav__item">@pageTitle</li>
        </ul>
    </nav>

  <header>
    <h1>@pageTitle</h1>
  </header>
  </br>

  @helper.form(action = routes.SubscriptionConfigurationController.saveConfigurations(application.id.toString, subscriptionViewModel.apiContext, subscriptionViewModel.version), 'class -> "fields-subscription") {
    <div class="form-field-group">
        @helper.CSRF.formField
        @helper.repeatWithIndex(form("fields")) { (field, index) =>
        <div class="form-field">
            <label class="label--full-length" for="@{subscriptionViewModel.apiContext}-@{subscriptionViewModel.version}-@{field("description").value.getOrElse("")}">
            <strong class="bold">@{subscriptionViewModel.fields(index).description}</strong>
            <p>@{subscriptionViewModel.fields(index).hint}</p>
            </label>

            @helper.input(field("name"), '_label -> null) { (id, name, value, args) =>
            <input type="hidden" name="@name" id="@id" value="@value">
            }
            
            @helper.input(field("value"), '_label -> null) { (id, name, value, args) =>
            <input type="text" name="@name" value="@{field("value").value.getOrElse("")}" class="form-input input--medium" id="@{IdFormatter.identifier(subscriptionViewModel.apiContext, subscriptionViewModel.version)}-@{field("name").value.getOrElse("")}">
            }
        </div>
        }

        <div class="form-field form-field--submit">
            <button id="@{IdFormatter.identifier(subscriptionViewModel.apiContext, subscriptionViewModel.version)}-submit" class="button submit-button" type="submit">Save changes</button>
            <a href="@routes.SubscriptionConfigurationController.listConfigurations(application.id.toString)" class="secondary-button button--link">Cancel</a>
        </div>

      }
</div>
}

