@*
 * Copyright 2022 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.gatekeeper.models._
@import uk.gov.hmrc.gatekeeper.views.helper.application._
@import uk.gov.hmrc.gatekeeper.config.AppConfig
@import uk.gov.hmrc.apiplatform.modules.gkauth.domain.models.LoggedInRequest
@import uk.gov.hmrc.gatekeeper.controllers.ApplicationEventsController._

@this(main: MainView, applicationConfig: AppConfig)

@(queryModel: QueryModel, form: Form[QueryForm])(implicit request: LoggedInRequest[_], flash: Flash)

@main(title = s"${applicationConfig.title} - Application Events") {

  <span class="govuk-caption-l">@{queryModel.applicationName}</span>
  <h1 class="govuk-heading-l">Application changes</h1>

  <h2 class="govuk-heading-m">Filters</h2> 

  @helper.form(action = controllers.routes.ApplicationEventsController.page(queryModel.applicationId), 'class -> "form") {
  @helper.CSRF.formField

    <div class="govuk-grid-row">
      @defining(form("eventTag").value) { eventTagValue =>
        <div class="govuk-grid-column-one-third">          
          <div class="govuk-form-group">
            <label class="govuk-label govuk-!-font-weight-bold" for="eventTag">
              Type of change
            </label>
            <select class="govuk-select" id="eventTagFilter" name="eventTag">
              <option value="" @if(eventTagValue == None) {selected}>All</option>      
              @for(eventTag <- queryModel.searchFilterValues.eventTags) {
                <option value="@eventTag" @if(eventTagValue == Some(eventTag)) {selected}>@eventTag</option>      
              }
            </select>
          </div>
        </div>
      }
    
      <div class="govuk-grid-column-full">          
        <button id="filterResults" class="govuk-button" type="submit">Filter results</button>
      </div>
    </div>
  }  

  <hr class="govuk-section-break govuk-section-break--m govuk-section-break--visible">
  
  @if(queryModel.events.isEmpty) {
    <p class="govuk-body">There are no matching application changes</p>
  } else {
    <table class="govuk-table responsive-table" data-module="moj-sortable-table">
      <thead class="govuk-table__head">
        <tr role="row" class="govuk-table__row">
          <th scope="col" class="govuk-table__header govuk-!-width-one-quarter" aria-sort="none">Date and time</th>
          <th scope="col" class="govuk-table__header govuk-!-width-one-quarter" aria-sort="ascending">Type of change</th>
          <th scope="col" class="govuk-table__header govuk-!-width-one-quarter" aria-sort="none">What changed</th>
          <th scope="col" class="govuk-table__header govuk-!-width-one-quarter" aria-sort="none">Changes made by</th>
        </tr>
      </thead>
      
      <tbody class="govuk-table__body">

        @for(event <- queryModel.events) {
          <tr role="row" class="govuk-table__row">
            <td role="cell" class="govuk-table__cell" data-event-time>@{event.eventDateTime}</td>
            <td role="cell" class="govuk-table__cell" data-event-tag>@{event.eventTag}</td>
            <td role="cell" class="govuk-table__cell" data-event-details>@{event.eventDetails}</td>
            <td role="cell" class="govuk-table__cell" data-event-actor>@{event.actor}</td>
          </tr>
        }
      </tbody>
    </table>   
  }
}   
