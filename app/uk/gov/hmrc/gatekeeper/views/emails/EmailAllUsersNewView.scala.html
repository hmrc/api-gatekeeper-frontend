@*
 * Copyright 2023 HM Revenue & Customs
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *@

@import uk.gov.hmrc.gatekeeper.models._
@import uk.gov.hmrc.gatekeeper.config.AppConfig
@import uk.gov.hmrc.gatekeeper.models.EmailOptionChoice.EmailOptionChoice
@import uk.gov.hmrc.apiplatform.modules.gkauth.domain.models.LoggedInUser
@import play.api.libs.json.JsValue
@import uk.gov.hmrc.gatekeeper.controllers.routes
@import uk.gov.hmrc.gatekeeper.views.models.Crumb

@this(main: MainView, applicationConfig: AppConfig)

@(users: Seq[RegisteredUser],
        composeEmailRecipients: JsValue,
        emails: String,
        offset: Int,
        limit: Int,
        totalCount: Int)(implicit request: Request[_], loggedInUser: LoggedInUser, messagesProvider: MessagesProvider)

    @currentPage = @{
        (offset / limit) + 1
    }

    @lastPage = @{
        val lp = (totalCount / limit)
        val remainder =  (totalCount % limit)
        if(remainder < limit) lp + 1 else remainder / limit
    }

    @main(
        title = s"${applicationConfig.title} - Emails all users",
        breadcrumbs = Seq(
            Crumb(
                "Back",
                s"${routes.EmailsPreferencesController.showEmailInformation("all-users")}",
                Some("data-back-link")
            )
        )
    ) {
        <div class="content__body full-width">
            <div><h1 class="govuk-heading-l govuk-!-margin-bottom-5" id="pageTitle">Email all users</h1></div>
            @recipientTableNew(users, composeEmailRecipients, emails, totalCount, new DevelopersEmailQuery(None, None, None, false, None, true, None), applicationConfig, Map("To" -> "All Developer Hub users"))

            <nav class="govuk-pagination" role="navigation" aria-label="results">

                @if(offset >= limit) {
                    <div class="govuk-pagination__prev">
                        <a class="govuk-link govuk-pagination__link" href="@routes.EmailsPreferencesController.emailAllUsersPage(offset - limit)" rel="prev">
                            <svg class="govuk-pagination__icon govuk-pagination__icon--prev" xmlns="http://www.w3.org/2000/svg" height="13" width="15" aria-hidden="true" focusable="false" viewBox="0 0 15 13">
                                <path d="m6.5938-0.0078125-6.7266 6.7266 6.7441 6.4062 1.377-1.449-4.1856-3.9768h12.896v-2h-12.984l4.2931-4.293-1.414-1.414z"></path>
                            </svg>
                            <span class="govuk-pagination__link-title">@messagesProvider.messages("pagination.previous")</span></a>
                    </div>
                }
                <ul class="govuk-pagination__list">

                    @if(currentPage > 2) {
                        <li class="govuk-pagination__item">
                            <a class="govuk-link govuk-pagination__link" href="@routes.EmailsPreferencesController.emailAllUsersPage()" aria-label="Page 1">
                                1
                            </a>
                        </li>
                    }
                    @if(currentPage > 3) {
                        <li class="govuk-pagination__item govuk-pagination__item--ellipses">&ctdot;</li>
                    }

                    @for(i <- (currentPage - 1).max(1) to (currentPage + 1).min(lastPage)) {
                        <li class="govuk-pagination__item @if(i == currentPage) {govuk-pagination__item--current}">
                            <a class="govuk-link govuk-pagination__link" href="@routes.EmailsPreferencesController.emailAllUsersPage((i - 1) * limit)" aria-label="Page @i" aria-current="page">
                            @i
                            </a>
                        </li>
                    }

                    @if(currentPage < lastPage - 2) {
                        <li class="govuk-pagination__item govuk-pagination__item--ellipses">&ctdot;</li>
                    }

                    @if(currentPage < lastPage - 1) {
                        <li class="govuk-pagination__item">
                            <a class="govuk-link govuk-pagination__link" href="@routes.EmailsPreferencesController.emailAllUsersPage(totalCount - limit)" aria-label="Page @{
                                lastPage
                            }">
                            @{
                                lastPage
                            }
                            </a>
                        </li>
                    }
                </ul>

                @if(offset < (totalCount - limit)  && (totalCount > limit)) {
                    <div class="govuk-pagination__next">
                        @if((offset + limit) == totalCount) {
                            <a class="govuk-link govuk-pagination__link" href="@routes.EmailsPreferencesController.emailAllUsersPage(offset + limit - 1)" rel="next"> <span class="govuk-pagination__link-title">@messagesProvider.messages("pagination.next")</span> <svg class="govuk-pagination__icon govuk-pagination__icon--next" xmlns="http://www.w3.org/2000/svg" height="13" width="15" aria-hidden="true" focusable="false" viewBox="0 0 15 13">
                                <path d="m8.107-0.0078125-1.4136 1.414 4.2926 4.293h-12.986v2h12.896l-4.1855 3.9766 1.377 1.4492 6.7441-6.4062-6.7246-6.7266z"></path>
                            </svg></a>
                        } else {
                            <a class="govuk-link govuk-pagination__link" href="@routes.EmailsPreferencesController.emailAllUsersPage(offset + limit)" rel="next"> <span class="govuk-pagination__link-title">@messagesProvider.messages("pagination.next")</span> <svg class="govuk-pagination__icon govuk-pagination__icon--next" xmlns="http://www.w3.org/2000/svg" height="13" width="15" aria-hidden="true" focusable="false" viewBox="0 0 15 13">
                                <path d="m8.107-0.0078125-1.4136 1.414 4.2926 4.293h-12.986v2h12.896l-4.1855 3.9766 1.377 1.4492 6.7441-6.4062-6.7246-6.7266z"></path>
                            </svg></a>
                        }
                    </div>
                }
            </nav>
        </div>
    }